/*
    yaat v1.0.7 - https://github.com/slapec/yaat
    build date: 2016-10-20T08:34:54.421Z
*/
angular.module("yaat",[]).config(["$interpolateProvider",function(e){e.startSymbol("[["),e.endSymbol("]]")}]).controller("YATableController",["$scope","$http",function(e,t){var a=this;e.$limit=e.$limit||25,e.$offset=e.$offset||null,e.$noDropdown=e.$noDropdown||!1,e.$noControls=e.$noControls||!1,e.$yaatId=e.$yaatId||null,e.$untouchedOffset=e.$offset,e.$postExtra={},e.$controlsTemplate=e.$controlsTemplate||"yatable/controls.html",e.$rowTemplate=e.$rowTemplate||"yatable/row.html",e.$pagingTemplate=e.$pagingTemplate||"yatable/paging.html",e.dropdownText=e.dropdownText||"Columns",e.$watch("$api",function(){e.init(e.$api,{api:!0})}),e.$watch("$limit",function(t,a){t!==a&&e.init(e.$api,{limit:!0})}),e.$on("yaat.http.post.add",function(t,a,n,o){if(void 0===o||o==e.$yaatId){if("offset"===a||"limit"===a||"headers"===a)throw Error("Key '"+a+"' conflicts with the internals of yaat");e.$postExtra[a]=n}}),e.$on("yaat.http.post.remove",function(t,a,n,o){void 0!==o&&o!=e.$yaatId||delete e.$postExtra[a]}),e.$on("yaat.init",function(t,a,n){void 0!==n&&n!=e.$yaatId||(e.$api===a&&e.init(e.$api,{"yaat.init":!0}),e.$api=a)}),e.$on("yaat.reload",function(t,a){void 0!==a&&a!=e.$yaatId||e.init(e.$api,{"yaat.reload":!0})}),e.$on("yaat.update",function(t,a){void 0!==a&&a!==e.$yaatId||e.update({"yaat.update":!0})}),void 0===e.init&&(e.init=function(n,o){if(void 0!==n){o=a.cleanFlags(angular.extend({init:!0},o));var i=angular.extend(o,a.initPayload(),e.$postExtra);t({method:"POST",url:n,data:i}).success(function(t){a.parse(t),e.$emit("yaat.http.success")}).error(function(t,a,n,o){e.$emit("yaat.http.error",t,a,n,o)})}}),void 0===e.update&&(e.update=function(n,o){1===arguments.length&&(o=n,n=void 0),void 0!==n&&a.applyOrder(n),o=a.cleanFlags(angular.extend({update:!0},o));var i=angular.extend(o,a.getPayload(),e.$postExtra);t({method:"POST",url:e.$api,data:i}).success(function(t){a.parse(t),e.$emit("yaat.http.success")}).error(function(t,a,n,o){e.$emit("yaat.http.error",t,a,n,o)})}),void 0===e.loadPage&&(e.loadPage=function(t){t&&(e.$offset=t,e.update({loadPage:!0}))}),void 0===e.getKey&&(e.getKey=function(t){return e.$visibleHeaders[t].key}),void 0===e.getIndex&&(e.getIndex=function(t){return e.$visibleHeadersReverse[t]}),e.toggleSorting=function(t){t.order=(t.order+1)%3,e.update({toggleSorting:!0})},this.parse=function(t){for(var a=[],n=[],o={},i=0,r=0;r<t.columns.length;r++){var l=t.columns[r];a.push(l),void 0===l.order&&(l.unorderable=!0),void 0===l.hidden?(l.unhideable=!0,n.push(l),o[l.key]=i++):l.hidden===!1&&(n.push(l),o[l.key]=i++)}e.$headers=a,e.$visibleHeaders=n,e.$visibleHeadersReverse=o,e.$rows=t.rows,e.$pages=t.pages,e.$offset=t.pages.current,e.$customData={},angular.forEach(t,function(t,a){"columns"!==a&&"rows"!==a&&"pages"!==a&&(e.$customData[a]=t)})},this.applyOrder=function(t){for(var a=$(t).find("li").map(function(){return this.id}).get(),n=[],o=0;o<a.length;o++)for(var i=0;i<e.$headers.length;i++)if(a[o]===e.$headers[i].key){n.push(e.$headers.splice(i,1)[0]);break}e.$headers=n},this.initPayload=function(){return{offset:e.$untouchedOffset,limit:e.$limit}},this.getPayload=function(){for(var t=[],a=e.$headers,n=0;n<a.length;n++){var o=a[n];t.push({order:o.order,hidden:o.hidden,key:o.key})}return{offset:e.$offset,limit:e.$limit,headers:t}},this.cleanFlags=function(e){var t={flags:{}};return angular.forEach(e,function(e,a){e===!0&&(t.flags[a]=e)}),t}}]).directive("yat",[function(){return{restrict:"E",controller:"YATableController",templateUrl:function(e,t){return void 0!==t.template?t.template:"yatable/table.html"},scope:!0,link:function(e,t,a){void 0!==a.api&&(e.$api=a.api),void 0!==a.limit&&(e.$limit=e.$eval(a.limit),e.$watch(a.limit,function(t,a){t!==a&&(e.$limit=t)})),void 0!==a.offset&&(e.$offset=a.offset,e.$untouchedOffset=a.offset),void 0!==a.dropdowntext&&(e.dropdownText=a.dropdowntext),void 0!==a.nodropdown&&(e.$noDropdown=!0),void 0!==a.nocontrols&&(e.$noControls=!0),void 0!==a.id&&(e.$yaatId=a.id);var n=function(){e.update(this,{sortable:!0})},o=e.$sortableOptions;if(void 0!==o)o.hasOwnProperty("update")||(o.update=n);else var o={axis:"y",containment:"parent",tolerance:"pointer",update:n};var i=e.$on("$includeContentLoaded",function(a,n){if("yatable/dropdown.html"===n&&(i(),!e.$noDropdown)){var r=$(t).find(".ya-headers");r.disableSelection(),r.sortable(o),$(document).on("click",".dropdown-menu",function(e){e.stopPropagation()})}});e.$emit("yaat.ready")}}}]),angular.module("yaat").run(["$templateCache",function(e){e.put("yatable/table.html",'<div class="yat"><div class="ya-ctrls" ng-hide="$noControls" ng-include="\'yatable/controls.html\'"></div><div class="ya-wrap"><table class="ya-table table table-bordered table-condensed table-customized table-striped"><thead><tr><th ng-repeat="header in $visibleHeaders" class="yh-[[ ::header.key ]]">[[ ::header.value ]] <span ng-switch on="header.order" ng-click="toggleSorting(header)" class="ya-sort-btn"><i ng-switch-when="0" class="glyphicon glyphicon-sort ya-unsorted"></i> <i ng-switch-when="1" class="glyphicon glyphicon-sort-by-attributes"></i> <i ng-switch-when="2" class="glyphicon glyphicon-sort-by-attributes-alt"></i></span></th></tr></thead><tbody ng-include="$rowTemplate"></tbody></table></div><nav class="ya-paging text-center" ng-include="\'yatable/paging.html\'"></nav></div>'),e.put("yatable/controls.html",'<div class="pull-right dropdown" ng-hide="$noDropdown" ng-include="\'yatable/dropdown.html\'"></div>'),e.put("yatable/dropdown.html",'<button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">[[ ::dropdownText ]] <span class="caret"></span></button><ol class="ya-headers dropdown-menu" aria-labelledby="dropdownMenu"><li ng-repeat="header in $headers" id="[[ ::header.key ]]"><input id="hide-[[ ::header.key ]]" type="checkbox" class="glyphicon ya-hide" ng-model="header.hidden" ng-disabled="header.unhideable" ng-click="update()"><label for="hide-[[ ::header.key ]]" class="glyphicon"></label><span class="ya-header-value">[[ ::header.value ]]</span></li></ol>'),e.put("yatable/row.html",'<tr ng-repeat="row in $rows"><td ng-repeat="cell in row.values track by $index" class="yc-[[ getKey($index) ]]">[[ ::cell ]]</td></tr>'),e.put("yatable/paging.html",'<ol class="pagination pagination-lg"><li ng-repeat="page in $pages.list track by $index" ng-class="{\'ya-prev\': $first, \'ya-next\': $last, \'ya-current active\': page.key===$pages.current}" ng-if="page"><a ng-click="loadPage(page.key)" ng-if="page.key !== $pages.current">[[ page.value ]]</a> <span ng-if="page.key === $pages.current">[[ page.value ]]</span></li></ol>')}]);