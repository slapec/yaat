angular.module("yaat",[]).controller("YATableController",["$scope","$http",function(e,a){var t=this;void 0===e.$limit&&(e.$limit=25),void 0===e.$offset&&(e.$offset=null),void 0===e.dropdownText&&(e.dropdownText="Columns"),e.$watch("$api",function(){e.init(e.$api)}),void 0===e.init&&(e.init=function(e){if(void 0!==e){var i=t.initPayload();a({method:"POST",url:e,data:i}).success(function(e){t.parse(e)})}}),void 0===e.update&&(e.update=function(i){void 0!==i&&t.applyOrder(i);var l=t.getPayload();a({method:"POST",url:e.$api,data:l}).success(function(e){t.parse(e)})}),void 0===e.loadPage&&(e.loadPage=function(a){e.$offset=a,e.update()}),void 0===e.getKey&&(e.getKey=function(a){return e.$headers[a].key}),this.parse=function(a){for(var t=[],i=[],l=0;l<a.columns.length;l++){var d=a.columns[l];t.push(d),void 0===d.desc&&(d.unsortable=!0),void 0===d.hidden?(d.unhideable=!0,i.push(d)):d.hidden===!1&&i.push(d)}e.$headers=t,e.$visibleHeaders=i,e.$rows=a.rows,e.$pages=a.pages},this.applyOrder=function(a){for(var t=$(a).sortable("toArray"),i=[],l=0;l<t.length;l++)for(var d=0;d<e.$headers.length;d++)if(t[l]===e.$headers[d].key){i.push(e.$headers.splice(d,1)[0]);break}e.$headers=i},this.initPayload=function(){return{offset:e.$offset,limit:e.$limit}},this.getPayload=function(){for(var a=[],t=e.$headers,i=0;i<t.length;i++){var l=t[i];a.push({desc:l.desc,hidden:l.hidden,key:l.key})}return{offset:e.$offset,limit:e.$limit,headers:a}}}]).directive("yat",[function(){return{restrict:"E",controller:"YATableController",templateUrl:"yatable/table.html",scope:!0,link:function(e,a,t){void 0!==t.api&&(e.$api=t.api),void 0!==t.limit&&(e.$limit=parseInt(t.limit)),void 0!==t.offset&&(e.$offset=t.offset),void 0!==t.dropdowntext&&(e.dropdownText=t.dropdowntext);var i=function(){e.update(this)},l=e.$sortableOptions;if(void 0!==l)l.hasOwnProperty("update")||(l.update=i);else var l={axis:"y",containment:"parent",tolerance:"pointer",update:i};var d=$(a).find(".ya-headers");d.disableSelection(),d.sortable(l)}}}]),angular.module("yaat").run(["$templateCache",function(e){e.put("yatable/table.html",'<div class="yat"><div class="ya-ctrls"><ul class="ya-drop"><li><span class="ya-drop-label">{{ dropdownText }}</span><ol class="ya-headers"><li ng-repeat="header in $headers" id="{{ header.key }}"><input type="checkbox" ng-model="header.hidden" ng-disabled="header.unhideable" ng-click="update()"> <span class="ya-header-value">{{ header.value }}</span> <input type="checkbox" ng-model="header.desc" ng-disabled="header.unsortable" ng-click="update()"></li></ol></li></ul></div><div class="ya-wrap"><table class="ya-table"><thead><tr><th ng-repeat="header in $visibleHeaders" class="yh-{{ header.key }}">{{ header.value }}</th></tr></thead><tbody><tr ng-repeat="row in $rows"><td ng-repeat="cell in row.values" class="yc-{{ getKey($index) }}">{{ cell }}</td></tr></tbody></table></div><nav class="ya-paging"><ol><li class="ya-prev"><a ng-click="loadPage($pages.prev.key)">{{ $pages.prev.value }}</a></li><li class="ya-current">{{ $pages.current.value }}</li><li class="ya-next"><a ng-click="loadPage($pages.next.key)">{{ $pages.next.value }}</a></li></ol></nav></div>')}]);