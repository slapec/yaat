/* Created: Mon Jul 13 2015 13:31:03 GMT+0200 (CEST)*/
angular.module("yaat",[]).config(["$interpolateProvider",function(e){e.startSymbol("[["),e.endSymbol("]]")}]).controller("YATableController",["$scope","$http",function(e,a){var t=this;e.$limit=e.$limit||25,e.$offset=e.$offset||null,e.$noDropdown=e.$noDropdown||!1,e.$untouchedOffset=e.$offset,e.$rowTemplate=e.$rowTemplate||"yatable/row.html",e.$pagingTemplate=e.$pagingTemplate||"yatable/paging.html",e.dropdownText=e.dropdownText||"Columns",e.$watch("$api",function(){e.init(e.$api)}),e.$watch("$limit",function(a,t){a!==t&&e.update()}),e.$on("yaat.http.extra",function(a,t){e.$httpExtra=t}),e.$on("yaat.init",function(a,t){e.$api===t&&e.init(e.$api),e.$api=t}),e.$on("yaat.update",function(){e.update()}),void 0===e.init&&(e.init=function(n){if(void 0!==n){var i=t.initPayload();void 0!==e.$httpExtra&&(i.extra=e.$httpExtra),a({method:"POST",url:n,data:i}).success(function(a){e.$emit("yaat.http.success"),t.parse(a)}).error(function(a,t,n,i){e.$emit("yaat.http.error",a,t,n,i)})}}),void 0===e.update&&(e.update=function(n){void 0!==n&&t.applyOrder(n);var i=t.getPayload();void 0!==e.$httpExtra&&(i.extra=e.$httpExtra),a({method:"POST",url:e.$api,data:i}).success(function(a){e.$emit("yaat.http.success"),t.parse(a)}).error(function(a,t,n,i){e.$emit("yaat.http.error",a,t,n,i)})}),void 0===e.loadPage&&(e.loadPage=function(a){a&&(e.$offset=a,e.update())}),void 0===e.getKey&&(e.getKey=function(a){return e.$headers[a].key}),e.toggleSorting=function(a){a.order=(a.order+1)%3,e.update()},this.parse=function(a){for(var t=[],n=[],i=0;i<a.columns.length;i++){var r=a.columns[i];t.push(r),void 0===r.order&&(r.unorderable=!0),void 0===r.hidden?(r.unhideable=!0,n.push(r)):r.hidden===!1&&n.push(r)}e.$headers=t,e.$visibleHeaders=n,e.$rows=a.rows,e.$pages=a.pages,e.$offset=a.pages.list[a.pages.current].key},this.applyOrder=function(a){for(var t=$(a).find("li").map(function(){return this.id}).get(),n=[],i=0;i<t.length;i++)for(var r=0;r<e.$headers.length;r++)if(t[i]===e.$headers[r].key){n.push(e.$headers.splice(r,1)[0]);break}e.$headers=n},this.initPayload=function(){return{offset:e.$untouchedOffset,limit:e.$limit}},this.getPayload=function(){for(var a=[],t=e.$headers,n=0;n<t.length;n++){var i=t[n];a.push({order:i.order,hidden:i.hidden,key:i.key})}return{offset:e.$offset,limit:e.$limit,headers:a}},e.$emit("yaat.ready")}]).directive("yat",[function(){return{restrict:"E",controller:"YATableController",templateUrl:function(e,a){return void 0!==a.template?a.template:"yatable/table.html"},scope:!0,link:function(e,a,t){void 0!==t.api&&(e.$api=t.api),void 0!==t.limit&&(e.$limit=e.$eval(t.limit),e.$watch(t.limit,function(a,t){a!==t&&(e.$limit=a)})),void 0!==t.offset&&(e.$offset=t.offset,e.$untouchedOffset=t.offset),void 0!==t.dropdowntext&&(e.dropdownText=t.dropdowntext),void 0!==t.nodropdown&&(e.$noDropdown=!0);var n=function(){e.update(this)},i=e.$sortableOptions;if(void 0!==i)i.hasOwnProperty("update")||(i.update=n);else var i={axis:"y",containment:"parent",tolerance:"pointer",update:n};var r=$(a).find(".ya-headers");r.disableSelection(),r.sortable(i),$(document).on("click",".dropdown-menu",function(e){e.stopPropagation()})}}}]).directive("ngIndeterminate",function(e){return{restrict:"A",link:function(e,a,t){e.$watch(t.ngIndeterminate,function(e){a.prop("indeterminate",!!e)})}}}),angular.module("yaat").run(["$templateCache",function(e){e.put("yatable/table.html",'<div class="yat"><div class="ya-ctrls" ng-hide="$noDropdown"><ul class="ya-drop"><li><span class="ya-drop-label">[[ ::dropdownText ]]</span><ol class="ya-headers"><li ng-repeat="header in $headers" id="[[ ::header.key ]]"><input type="checkbox" class="ya-hide" ng-model="header.hidden" ng-disabled="header.unhideable" ng-click="update()"> <span class="ya-header-value">[[ ::header.value ]]</span></li></ol></li></ul></div><div class="ya-wrap"><table class="ya-table"><thead><tr><th ng-repeat="header in $visibleHeaders" class="yh-[[ ::header.key ]]"><input type="checkbox" class="ya-sort" ng-model="header.desc" ng-disabled="header.unorderable" ng-click="update()"> [[ ::header.value ]]</th></tr></thead><tbody ng-include="$rowTemplate"></tbody></table></div><nav class="ya-paging" ng-include="$pagingTemplate"></nav></div>'),e.put("yatable/row.html",'<tr ng-repeat="row in $rows"><td ng-repeat="cell in row.values track by $index" class="yc-[[ getKey($index) ]]">[[ ::cell ]]</td></tr>'),e.put("yatable/paging.html",'<ol><li ng-repeat="page in $pages.list track by $index" ng-class="{\'ya-prev\': $first, \'ya-next\': $last, \'ya-current\': $index==$pages.current}"><a ng-click="loadPage(page.key)" ng-if="$index !== $pages.current">[[ page.value ]]</a> <span ng-if="$index === $pages.current">[[ page.value ]]</span></li></ol>'),e.put("yatable/bootstrap_table.html",'<div class="yat"><div class="ya-ctrls dropdown pull-right" ng-hide="$noDropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">[[ ::dropdownText ]] <span class="caret"></span></button><ol class="ya-headers dropdown-menu" aria-labelledby="dropdownMenu"><li ng-repeat="header in $headers" id="[[ ::header.key ]]"><input type="checkbox" class="glyphicon ya-hide" ng-model="header.hidden" ng-disabled="header.unhideable" ng-click="update()"> <span class="ya-header-value">[[ ::header.value ]]</span></li></ol></div><div class="ya-wrap"><table class="ya-table table table-bordered table-condensed table-customized table-striped"><thead><tr><th ng-repeat="header in $visibleHeaders" class="yh-[[ ::header.key ]]"><input type="checkbox" class="glyphicon ya-sort" ng-indeterminate="header.order==1" ng-checked="header.order==2" ng-hide="header.unorderable" ng-click="toggleSorting(header)"> [[ ::header.value ]]</th></tr></thead><tbody ng-include="$rowTemplate"></tbody></table></div><nav class="ya-paging text-center" ng-include="\'yatable/bootstrap_paging.html\'"></nav></div>'),e.put("yatable/bootstrap_paging.html",'<ol class="pagination pagination-lg"><li ng-repeat="page in $pages.list track by $index" ng-class="{\'ya-prev\': $first, \'ya-next\': $last, \'ya-current active\': $index==$pages.current}"><a ng-click="loadPage(page.key)" ng-if="$index !== $pages.current">[[ page.value ]]</a> <span ng-if="$index === $pages.current">[[ page.value ]]</span></li></ol>')}]);