angular.module("yaat",[]).controller("YATableController",["$scope","$http",function(e,a){var t=this;this.init=function(e){void 0!==e&&a({method:"POST",url:e}).success(function(e){t.parse(e)})},this.parse=function(a){for(var t=[],r=[],l=0;l<a.columns.length;l++){var n=a.columns[l];t.push(n),n.hidden===!1&&r.push(n)}e.headers=t,e.visibleHeaders=r,e.rows=a.rows},this.applyOrder=function(a){for(var t=$(a).sortable("toArray"),r=[],l=0;l<t.length;l++)for(var n=0;n<e.headers.length;n++)if(t[l]===e.headers[n].key){r.push(e.headers.splice(n,1));break}e.headers=r},e.update=function(r){return void 0!==r?void t.applyOrder(r):void a({method:"POST",url:e.apiUrl}).success(function(e){t.parse(e)})},e.$watch("apiUrl",function(){t.init(e.apiUrl)}),window.getScope=function(){console.log(e)}}]).directive("yat",[function(){return{restrict:"E",controller:"YATableController",templateUrl:"yatable/table.html",scope:!0,link:function(e,a,t){void 0!==t.api&&(e.apiUrl=t.api);var r=$(a).find(".ya-headers");r.disableSelection(),r.sortable({axis:"y",containment:"parent",tolerance:"pointer",update:function(){e.update(this)}})}}}]),angular.module("yaat").run(["$templateCache",function(e){e.put("yatable/table.html",'<div class="yat"><div class="ya-ctrls"><ol class="ya-headers"><li ng-repeat="header in headers" id="{{ header.key }}"><input type="checkbox" ng-model="header.hidden" ng-click="update()"> <span class="ya-header-value">{{ header.value }}</span> <input type="checkbox" ng-model="header.desc" ng-click="update()"></li></ol></div><table class="ya-table"><thead><tr><td ng-repeat="header in visibleHeaders">{{ header.value }}</td></tr></thead><tbody><tr ng-repeat="row in rows"><td ng-repeat="cell in row">{{ cell }}</td></tr></tbody></table><pre class="ya-debug">headers={{ headers }}\nvisibleHeaders={{ visibleHeaders }}</pre></div>')}]);